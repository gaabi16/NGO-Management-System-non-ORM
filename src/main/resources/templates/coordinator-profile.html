<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordinator Profile</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; }

        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: white; position: relative; z-index: 100; }
        .nav-brand { font-size: 1.5rem; font-weight: bold; }
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-btn { color: white; text-decoration: none; font-weight: 500; padding: 8px 16px; border-radius: 20px; transition: background 0.3s; font-size: 0.95rem; }
        .nav-btn:hover { background: rgba(255,255,255,0.2); }

        .logout-btn {
            background: #dc3545;
            border: none;
            cursor: pointer;
            color: white;
            font-weight: 500;
            padding: 5px 12px;
            font-size: 0.85rem;
            border-radius: 15px;
            margin-left: 5px;
            transition: background 0.3s;
        }
        .logout-btn:hover { background: #c82333; }

        .profile-container { max-width: 1200px; margin: 40px auto; width: 100%; display: flex; gap: 30px; padding: 0 20px; flex: 1; }

        /* Animation: Slide In Left for Menu */
        .profile-menu {
            width: 280px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: fit-content;
            overflow: hidden;
            opacity: 0;
            animation: slideInLeft 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        .menu-header { background: #f8f9fa; padding: 20px; border-bottom: 1px solid #eee; text-align: center; }
        .menu-avatar { font-size: 3rem; margin-bottom: 10px; transition: transform 0.3s; display: inline-block; }
        .profile-menu:hover .menu-avatar { transform: scale(1.1); }

        .menu-user-name { font-weight: 700; color: #333; }
        .menu-list { list-style: none; padding: 10px 0; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: all 0.3s; color: #555; font-weight: 500; display: flex; align-items: center; gap: 10px; border-left: 4px solid transparent; }
        .menu-item:hover { background-color: #f8f9fa; color: #667eea; padding-left: 30px; }
        .menu-item.active { background-color: #f0f2ff; color: #667eea; border-left-color: #667eea; }
        .menu-item.danger { color: #dc3545; }
        .menu-item.danger:hover { background-color: #fff5f5; }

        /* Animation: Slide In Right for Content */
        .profile-content {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 40px;
            position: relative;
            opacity: 0;
            animation: slideInRight 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            animation-delay: 0.2s;
        }

        .content-header { margin-bottom: 30px; border-bottom: 2px solid #f0f2f5; padding-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .content-title { font-size: 1.8rem; color: #333; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* Animation: Hidden initially for Cascade Effect */
        .form-group { margin-bottom: 20px; opacity: 0; }
        .form-group.full-width { grid-column: 1 / -1; }

        label { display: block; color: #666; margin-bottom: 8px; font-weight: 500; font-size: 0.9rem; }
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background-color: #fff; color: #333; }
        input:disabled, textarea:disabled, select:disabled { background-color: #f8f9fa; color: #666; cursor: not-allowed; border-color: #eee; opacity: 0.8; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); transform: translateY(-2px); }

        .action-buttons {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease;
        }

        .btn { padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn-save { background: #28a745; color: white; }
        .btn-discard { background: #6c757d; color: white; }
        .btn-save:hover { background: #218838; }
        .btn-discard:hover { background: #5a6268; }

        .alert { padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: 500; text-align: center; animation: slideDown 0.4s ease-out; }
        .alert-success { background-color: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
        .optional { color: #999; font-size: 12px; font-weight: normal; }
        .required { color: #dc3545; font-size: 12px; font-weight: bold; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s; backdrop-filter: blur(2px); }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 450px; text-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideUpModal 0.4s; }
        .warning-icon { font-size: 3rem; margin-bottom: 15px; animation: pulseWarning 2s infinite; }
        .modal-title { font-size: 1.5rem; color: #333; margin-bottom: 10px; }
        .modal-text { color: #666; margin-bottom: 25px; line-height: 1.5; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; }
        .btn-delete-confirm { background: #dc3545; color: white; }
        .btn-cancel { background: #e2e6ea; color: #333; }

        /* Animation Keyframes */
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUpModal { from { opacity: 0; transform: translateY(30px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes pulseWarning { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="nav-brand">Coordinator Dashboard</div>
    <div class="nav-links">
        <a th:href="@{/coordinator/dashboard(view='activities')}"
           class="nav-btn">Manage Activities</a>

        <a th:href="@{/coordinator/dashboard(view='volunteers')}"
           class="nav-btn">Manage Volunteers</a>

        <a href="/coordinator/profile" class="nav-btn" style="background: rgba(255,255,255,0.2);">Profile</a>

        <form th:action="@{/logout}" method="post" style="display:inline;">
            <button class="logout-btn">Logout</button>
        </form>
    </div>
</nav>

<div class="profile-container">
    <div class="profile-menu">
        <div class="menu-header">
            <div class="menu-avatar">üë§</div>
            <div class="menu-user-name" th:text="${profile.user.firstName + ' ' + profile.user.lastName}">Coordinator Name</div>
        </div>
        <ul class="menu-list">
            <li class="menu-item active" id="menuInfo" onclick="setViewMode()">üìã Account Info</li>
            <li class="menu-item" id="menuEdit" onclick="setEditMode()">‚úèÔ∏è Edit Profile</li>
            <li class="menu-item danger" onclick="openDeleteModal()">üóëÔ∏è Delete Account</li>
        </ul>
    </div>

    <div class="profile-content">
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

        <div class="content-header">
            <h2 class="content-title">Personal Information</h2>
        </div>

        <form id="profileForm" th:action="@{/coordinator/profile/update}" method="post" th:object="${profile}" novalidate>
            <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem; opacity: 0; animation: fadeInUp 0.5s ease-out forwards 0.4s;">Account Details</h3>
            <div class="form-grid">
                <div class="form-group"><label>First Name <span class="required">*</span></label><input type="text" th:field="*{user.firstName}" disabled required></div>
                <div class="form-group"><label>Last Name <span class="required">*</span></label><input type="text" th:field="*{user.lastName}" disabled required></div>
                <div class="form-group"><label>Email (Read-only)</label><input type="email" th:field="*{user.email}" disabled style="background-color: #e9ecef; cursor: not-allowed;"><input type="hidden" th:field="*{user.email}"></div>
                <div class="form-group"><label>Phone Number <span class="optional">(optional)</span></label><input type="text" th:field="*{user.phoneNumber}" disabled></div>
            </div>

            <h3 style="color: #28a745; margin: 20px 0 15px 0; font-size: 1.1rem; opacity: 0; animation: fadeInUp 0.5s ease-out forwards 0.8s;">Coordinator Details</h3>
            <div class="form-grid">
                <div class="form-group"><label>Department</label><input type="text" th:field="*{department}" disabled></div>
                <div class="form-group"><label>Experience (Years)</label><input type="number" th:field="*{experienceYears}" disabled></div>
                <div class="form-group full-width"><label>Employment Type</label>
                    <select th:field="*{employmentType}" disabled>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Volunteer">Volunteer Basis</option>
                    </select>
                </div>
            </div>

            <div class="action-buttons" id="actionButtons">
                <button type="button" class="btn btn-discard" onclick="cancelEdit()">Discard Changes</button>
                <button type="submit" class="btn btn-save">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<div id="deleteModal" class="modal">
    <div class="modal-content">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3 class="modal-title">Delete Account?</h3>
        <p class="modal-text">Are you sure you want to delete your coordinator account? This action is permanent.</p>
        <div class="modal-actions">
            <button class="btn btn-cancel" onclick="closeDeleteModal()">Cancel</button>
            <form th:action="@{/coordinator/profile/delete}" method="post">
                <button type="submit" class="btn btn-delete-confirm">Yes, Delete My Account</button>
            </form>
        </div>
    </div>
</div>

<script>
    // --- Added Animations ---
    document.addEventListener('DOMContentLoaded', function() {
        // Cascade animation for inputs
        const formGroups = document.querySelectorAll('.form-group');
        formGroups.forEach((group, index) => {
            const delay = 0.4 + (index * 0.1);
            group.style.animation = `fadeInUp 0.6s ease-out forwards ${delay}s`;
        });
    });

    const form = document.getElementById('profileForm');
    // Selectam input-urile care nu sunt hidden si nu sunt email (email e read-only oricum in backend de obicei)
    const inputs = form.querySelectorAll('input:not([type="hidden"]):not([name="user.email"]), textarea, select');
    const actionButtons = document.getElementById('actionButtons');
    const menuInfo = document.getElementById('menuInfo');
    const menuEdit = document.getElementById('menuEdit');

    function setEditMode() {
        menuInfo.classList.remove('active');
        menuEdit.classList.add('active');

        // Smooth fade in for buttons
        actionButtons.style.display = 'flex';
        requestAnimationFrame(() => {
            actionButtons.style.opacity = '1';
            actionButtons.style.transform = 'translateY(0)';
        });

        inputs.forEach(input => {
            input.disabled = false;
            input.style.backgroundColor = '#fff';
        });
    }

    function setViewMode() {
        menuInfo.classList.add('active');
        menuEdit.classList.remove('active');

        // Hide buttons
        actionButtons.style.opacity = '0';
        actionButtons.style.transform = 'translateY(10px)';
        setTimeout(() => { actionButtons.style.display = 'none'; }, 300);

        inputs.forEach(input => { input.disabled = true; });
    }

    function cancelEdit() { window.location.reload(); }

    const deleteModal = document.getElementById('deleteModal');
    function openDeleteModal() { deleteModal.style.display = 'flex'; }
    function closeDeleteModal() { deleteModal.style.display = 'none'; }
    window.onclick = function(event) { if (event.target == deleteModal) { closeDeleteModal(); } }

    setTimeout(function() {
        document.querySelectorAll('.alert').forEach(a => {
            a.style.transition = 'opacity 0.3s ease';
            a.style.opacity = '0';
            setTimeout(() => a.remove(), 300);
        });
    }, 3000);
</script>

</body>
</html>